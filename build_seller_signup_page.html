<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller sign up</title>
    <link rel="stylesheet" href="./src/public/css/home_page.css">
    <link rel="stylesheet" href="./src/public/css/login_page.css">
    <link rel="stylesheet" href="./src/public/css/myAccount_page.css">
    <link rel="stylesheet" href="./src/public/css/product_detail_page.css">
    <link rel="stylesheet" href="./src/public/css/seller_signup_page.css">
</head>
<body>
    
    <div id="main_seller">
        <div id="header_seller">
            <div class="header_seller-title">
                <img src="https://anhdep.tv/attachments/ac1afeb3909de0315b221710d037f01c-jpeg.5868/" alt="">
                <h3>Đăng ký trở thành người bán của NT SHOP</h3>
            </div>
        </div>
        <div id="content_seller" class="content_seller_signup">
            <div class="content_seller_signup-wrapper">
                <form  class="content_seller_signup-form" method="post" autocomplete="off">
                    <h4 class="content_seller_signup-form-title">Đăng ký chủ sở hữu</h4>
                    <div class="content_seller_signup-user_info hidden">
                        <div class="wrapper_input">
                            <input name="name" class="wrapper_input-input input_name" type="text" placeholder=" " maxlength="50" required>
                            <label class="wrapper_input-label" for="name">Họ tên</label>
                        </div>
                        <div class="wrapper_input">
                            <input name="identity" class="wrapper_input-input input_identity" type="text" placeholder=" " maxlength="20" required>
                            <label class="wrapper_input-label" for="identity">Số CCCD/CMND</label>
                        </div>
                        <div class="wrapper_input">
                            <input name="phone_number" class="wrapper_input-input input_phone_number" type="text" placeholder=" " maxlength="15" required>
                            <label class="wrapper_input-label" for="phone_number">Số điện thoại</label>
                        </div>
                        <div class="wrapper_input">
                            <input name="email" class="wrapper_input-input input_email" type="text" placeholder=" " maxlength="30" required>
                            <label class="wrapper_input-label" for="email">Email</label>
                        </div>
                        <!-- <span class = "notify_text">(Vui lòng kiểm tra email để nhận mã)</span> -->
                        <span class="send_code_btn signup_btn">Gửi mã</span>
                        <div class="wrapper_input">
                            <input name="confirm_code" class="wrapper_input-input input_confirm_code" type="text" placeholder=" " maxlength="6" required>
                            <label class="wrapper_input-label" for="confirm_code">Mã xác nhận</label>
                        </div>
                        <span class="next_btn signup_btn">Tiếp</span>
                    </div>

                    <div class="content_seller_signup-shop_info">
                        <div class="wrapper_input">
                            <input name="shop_name" class="wrapper_input-input shop_name" type="text" placeholder=" " maxlength="50" required>
                            <label class="wrapper_input-label" for="shop_name">Tên shop</label>
                        </div>
                        <div class="wrapper_input">
                            <textarea class="wrapper_input-input textarea_name" required wrap="hard" rows="5" name="shop_address" maxlength="150" placeholder=" "></textarea>
                            <label class="wrapper_input-label" for="shop_name">Địa chỉ của shop</label>
                        </div>
                        <div class="wrapper_input">
                            <input name="shop_phone_number" class="wrapper_input-input shop_phone_number" type="text" placeholder=" " maxlength="50" required>
                            <label class="wrapper_input-label" for="shop_phone_number">Số điện thoại liên hệ</label>
                        </div>
                        <span class="add_shop_avatar_text">Ảnh đại diện của shop</span>
                        <div class="shop_avatar">
                            <div class="add_shop_avatar">
                                <i class="fa-solid fa-plus"></i>
                            </div>
                            <input type="file">
                        </div>
                        <div class="btn_form">
                            <span class="back_btn_signup signup_btn">Quay lại</span>
                            <button type="button" class="sign_up_btn signup_btn" >Đăng ký</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div id="footer_seller"></div>
    </div>

    <!-- ======================================================== đăng ký chủ shop ============================================ -->
    <script>
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);

        let nextBtn = $('.next_btn');
        let emailIput = $('.input_email');
        let sendBtn = $('.send_code_btn ');
        let code = 0;
        let form = $('.content_seller_signup-form');
        
        function sendMail(){
            Email.send({
                SecureToken : "43c30770-0c5f-4b6a-975a-d2b1170f477c",
                // password to create secureToken: D058E92B98DA65D960EDA0E9C8985B7CD971
                To : emailIput.value,
                From : "xacthucmail123@gmail.com",
                Subject : "Use this code to sign-up",
                Body : `<h3>Mã xác nhận của bạn là  <strong>${code}</strong></h3>`
            }).then(
                () => alert("Vui lòng kiểm tra email của bạn (chú ý spam).")
            ); 
        }
        // thanghn2503@gmail.com
        
        sendBtn.onclick = function(){
            if(emailIput.value.length <= 6){
                alert('Vui lòng đúng nhập emai của bạn.');
            }
            else {
                code = Math.floor(Math.random() * 1000001);
                while(code < 100000){
                    code = Math.floor(Math.random() * 1000001);
                }
                sendMail();
            }
        }

        nextBtn.onclick = function(){
            if($('.input_confirm_code').value != code || code == ''){
                alert('Mã sai, vui lòng kiểm tra lại.')
            }
            else if($('.input_name').value.length == 0 || $('.input_email').value.length == 0 || $('.input_identity').value.length == 0 || $('.input_phone_number').value.length == 0){
                alert('Vui lòng điền đầy đủ các thông tin.')
            }
            else {
                $('.content_seller_signup-user_info').classList.add('hidden');
                $('.content_seller_signup-shop_info').classList.remove('hidden');
            }
        }

    </script>
    <!-- ======================================================== Đăng ký shop ============================================= -->
    <script>
        let shopAvatar = $('.shop_avatar');

        $('.textarea_name').onkeypress = function(e){
            if(e.which == 13){
                let numberOfLines = (this.value.match(/\n/g) || []).length + 1;
                if(numberOfLines >= 5) return false;
            }
        }

        $('.back_btn_signup').onclick = function(){
            $('.content_seller_signup-user_info').classList.remove('hidden');
            $('.content_seller_signup-shop_info').classList.add('hidden');
        }

        form.onsubmit = function(e){
            e.preventDefault();
        }

        $('.sign_up_btn').onclick = function(){
            if($('.shop_name').value.length == 0 || $('.textarea_name').value.length == 0 || $('.shop_phone_number').value.length == 0){
                alert('Vui lòng điền đầy đủ thông tin');
            }
            else {
                form.action = '/user/seller/signup/successful';
                form.submit();
            }
        }

        // =========================================================== xử lý hình ảnh =======================================
        const reader = new FileReader();
        $('.shop_avatar input').addEventListener("change", (event) => {
            const files = event.target.files;
            reader.readAsDataURL(files[0]);
            reader.addEventListener("load", (event) => {
                base64String = reader.result.replace("data:", "").replace(/^.+,/, "");
                // console.log(base64String);  lấy dạng base64 của hình ảnh vừa chọn

                const binary = event.target.result;
                var img = binary.slice(binary.lastIndexOf(',') + 1);

                // hàm tạo url cho thuộc tính src của ảnh
                const b64toBlob = (img, contentType = '', sliceSize = 512) => {
                    const byteCharacters = atob(img);   // giải mã chuỗi mã hóa base64
                    const byteArrays = [];

                    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                        const slice = byteCharacters.slice(offset, offset + sliceSize);

                        const byteNumbers = new Array(slice.length);
                        for (let i = 0; i < slice.length; i++) {
                            byteNumbers[i] = slice.charCodeAt(i); // lấy mã Unicode 
                        }

                        const byteArray = new Uint8Array(byteNumbers); // tạo mảng kiểu 8bit
                        byteArrays.push(byteArray);
                    }

                    const blob = new Blob(byteArrays, { type: contentType });
                    return blob;
                }
                const blob = b64toBlob(img, 'image/jpeg');
                const blobUrl = URL.createObjectURL(blob);  // tạo url mới
                $('.shop_avatar').style.background = `url(${blobUrl}) no-repeat center / contain`;
                $('.add_shop_avatar').classList.add('hidden');
            })
        })

    </script>

    <!-- link fontawesome icons -->
    <script src="https://kit.fontawesome.com/f53f2021c2.js" crossorigin="anonymous"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>

</body>
</html>